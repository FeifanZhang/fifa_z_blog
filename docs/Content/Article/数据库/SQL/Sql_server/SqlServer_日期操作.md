# 日期相关语法
## 获取当前日期

```sql
select getdate()
```

## 日期相减
* 语法: `dateDiff(时间单位, startDate, endDate)`
  * 时间单位
    |参数|缩写|备注|
    |--|--|--|
    |year|yy, yyyy|年|
    |quarter|qq,q|季度|
    |month|mm,m|月|
    |dayofyear|dy,y|一年中的第几天|
    |day|dd,d|日|
    |week|wk，ww|一年中的第几周（注意！wk相等的区间为**上周日 ~ 本周六**）|
    |weekday|dw|星期几（返回`1`为周日，`2`为周一 ... 7为周六）|
    |Hour|hh|小时|
    |minute|mi,n|分钟|
    |second|ss,s|秒|
    |millisecond|ms|毫秒|
    |mns|mns|微秒|
    |ns|ns|纳秒|
  * 这些日期单位可以用于`dateDiff()`,`datepart()`，`dateAdd()`等日期相关计算中
  * `dateDiff(时间单位, startDate, endDate)`相当于`datePart(时间单位, endDate) - datepart(时间单位, startDate)`

## 每周相关数据
因为数据库中的一周从**上周日**到**本周六**，所以做与每周日期相关逻辑时 要`日期 - 1天`（使用前一天的日期），将真实日期与数据库每周的边界日期对齐

### 获取本周一的日期
```sql
select dateAdd(week, dateDiff(week,0, GETDATE() - 1),0)
```

### 获取本周日的日期
* 在`本周一的日期`的基础上 `+ 6天`
    ```sql
    select dateAdd(day, 6, dateAdd(week, dateDiff(week,0, GETDATE() - 1),0))
    ```

### 获取本周内全部数据
```sql
select * from dataTable where dateDiff(week, getDate() - 1, create_time - 1) = 0
```


## 日期 —> 字符串转换
* 字符串转日期：
    ```sql
    convert(datetime, '2006-05-16 10:57:46.827')
    ```

* 日期转字符串：
    ```sql
    SELECT (varchar, GETDATE(), 121)
    ```

  * `getdate()`：获取当前日期
  * `121`：日期格式编码，下文中会介绍全部编码以及对应的日期样式
* 无法通过`convert`将一种日期格式转换成另外一种

    ```sql
    SELECT CONVERT(DATETIME, GETDATE(), 0)  -- 2022-12-09 21:11:07
    SELECT CONVERT(DATETIME, GETDATE(), 3)  -- 2022-12-09 21:11:07
    ```

# 日期格式编码
`convert`将日期转换为字符串时，最后一个参数表明日期格式，我们以**2006年5月16日 10:57:46:827**为例

|日期格式编码|日期格式|标准名称|
|--|--|--|
|0 或 100|05 16 2006 10:57AM|默认格式|
|1|05/16/06|
|2|06.05.16|
|3|16/05/06|
|4|16.05.06|
|5|16-05-06|
|6|16 15 06|
|7|05 16, 06|
|8|10:57:46|
|9 或 109|05 16 2006 10:57:46:827AM|默认格式 + 毫秒|
|10|05-16-06|
|11|06/05/16|
|12|060516|
|13 或 113|16 05 2006 10:57:46:827|欧洲默认格式 + 毫秒|
|14|10:57:46:827|
|20 或 120|2006-05-16 10:57:46|OBDC规范|
|21 或 121|2006-05-16 10:57:46.827|OBDC规范 + 毫秒|
|22|06/05/16 10:57:46 AM|
|23|2006-05-16|
|24|10:57:46|
|25|2006-05-16 10:57:46.827|
|101|05/16/2006|美国|
|102|2006.05.16|ANSI|
|103|16/05/2006|英法|
|104|16.05.2006|德国|
|105|16-05-2006|意大利|
|106|16 05 2006|
|107|05 16, 2006|
|108|10:57:49|
|110|05-16-2006|美国|
|111|2006/05/16|日本|
|112|20060516|ISO|
|114|10:57:46:827|
|126|2006-05-16T10:57:46:827|ISO8601|
|130|转换不出来~|科威特|
|131|18/04/1427 10:57:46:827AM|科威特|


# 参考
* [SQL Server中日期格式的转换](https://blog.csdn.net/pan_junbiao/article/details/82930852)
* [SQL Server字符串转日期格式](https://www.cnblogs.com/tiandao99/p/15430318.html)
* [sql 查询本周周一与周日时间 ](https://blog.51cto.com/mingblogs/5337355)
